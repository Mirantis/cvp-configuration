FROM xrally/xrally-openstack:2.1.0

LABEL maintainer="qa-ps@mirantis.com"

WORKDIR /rally
RUN mkdir /rally/rally-files && \
    sudo apt-get update && \
    sudo apt-get install -y wget curl git

RUN git clone https://github.com/Mirantis/rally-plugins.git && \
    cd rally-plugins/ && \
    pip3 install . && \
    # since rally-plugins use v1beta1 API which is deprecated, downgrade kubernetes
    pip3 install kubernetes==21.7.0 && \
    cd /rally && \
    rally plugin list | grep kubernetes

COPY ./rally-files/* /rally/rally-files/ 

ENTRYPOINT ["bash"]

